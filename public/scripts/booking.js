import { responseToJson, dateToUnixStamp } from './search.js';
import { localS } from './localStorage.js';
import { renderToast } from './lib.js';
// const fetch = require('node-fetch')
// function searchForBooking(checkInDate: Date, checkOutDate: Date, maxPrice: number) {
//   let url = `http://localhost:3030/places?checkInDate=${dateToUnixStamp(checkInDate)}&checkOutDate=${dateToUnixStamp(checkOutDate)}&coordinates=59.9386,30.3141`
//   if (maxPrice != null) {
//     url += `&maxPrice=${maxPrice}`
//   }
//   return responseToJson(fetch(url))
// }
export function book(placeId, checkInDate, checkOutDate) {
    if (placeId && checkInDate && checkOutDate) {
        const data = responseToJson(fetch(`http://localhost:3030/places/${placeId}?` +
            `checkInDate=${dateToUnixStamp(checkInDate)}&` +
            `checkOutDate=${dateToUnixStamp(checkOutDate)}&`, { method: 'PATCH' }));
        if (data) {
            console.log(`booked: ${placeId}, chek in: ${checkInDate.getTime()}, check out: ${checkOutDate.getTime()}`);
            const bookRes = {
                'id': placeId,
                'checkIn': checkInDate.getTime(),
                'checkOut': checkOutDate.getTime()
            };
            localS.set('booked', bookRes);
            renderToast({ text: `Вы забронировали номер ${placeId} с ${new Date(checkInDate).toLocaleString('ru-RU')} по ${new Date(checkOutDate).toLocaleString('ru-RU')}`, type: 'success' }, { name: 'Ок', handler: () => { console.log('Уведомление закрыто'); } });
        }
    }
    else {
        return false;
    }
}
export function bookStart() {
    document.querySelectorAll('.result-info--footer button').forEach((elt) => {
        elt.addEventListener('click', (ev) => {
            const checkInDate = new Date(document.getElementById('check-in-date').getAttribute('value'));
            const checkOutDate = new Date(document.getElementById('check-out-date').getAttribute('value'));
            const target = ev.target;
            const placeId = target.closest('.result').getAttribute('id').substring(5);
            console.log(`${placeId}, ${checkInDate}, ${checkOutDate}`);
            book(placeId, checkInDate, checkOutDate);
        });
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9va2luZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ib29raW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLE1BQU0sYUFBYSxDQUFBO0FBQzdELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQTtBQUMxQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBS3RDLHNDQUFzQztBQUl0Qyx1RkFBdUY7QUFDdkYsbUtBQW1LO0FBRW5LLDRCQUE0QjtBQUM1QixxQ0FBcUM7QUFDckMsTUFBTTtBQUVOLHNDQUFzQztBQUN0QyxJQUFJO0FBR0osTUFBTSxVQUFVLElBQUksQ0FBQyxPQUF3QixFQUFFLFdBQXdCLEVBQUUsWUFBeUI7SUFJaEcsSUFBSSxPQUFPLElBQUksV0FBVyxJQUFJLFlBQVksRUFBRTtRQUUxQyxNQUFNLElBQUksR0FBRyxjQUFjLENBQUMsS0FBSyxDQUMvQixnQ0FBZ0MsT0FBTyxHQUFHO1lBQzFDLGVBQWUsZUFBZSxDQUFDLFdBQVcsQ0FBQyxHQUFHO1lBQzlDLGdCQUFnQixlQUFlLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFDaEQsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFDLENBQ2xCLENBQUMsQ0FBQztRQUVILElBQUksSUFBSSxFQUFFO1lBRVIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLE9BQU8sY0FBYyxXQUFXLENBQUMsT0FBTyxFQUFFLGdCQUFnQixZQUFZLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFBO1lBRTFHLE1BQU0sT0FBTyxHQUFHO2dCQUNkLElBQUksRUFBRSxPQUFPO2dCQUNiLFNBQVMsRUFBRSxXQUFXLENBQUMsT0FBTyxFQUFFO2dCQUNoQyxVQUFVLEVBQUUsWUFBWSxDQUFDLE9BQU8sRUFBRTthQUNuQyxDQUFBO1lBRUQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFFLENBQUE7WUFFOUIsV0FBVyxDQUNULEVBQUUsSUFBSSxFQUFFLDBCQUEwQixPQUFPLE1BQU0sSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsRUFDdEssRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUEsQ0FBQyxDQUFDLEVBQUUsQ0FDdEUsQ0FBQTtTQUVGO0tBRUY7U0FDSTtRQUNILE9BQU8sS0FBSyxDQUFBO0tBQ2I7QUFJSCxDQUFDO0FBSUQsTUFBTSxVQUFVLFNBQVM7SUFFdkIsUUFBUSxDQUFDLGdCQUFnQixDQUFDLDZCQUE2QixDQUFDLENBQUMsT0FBTyxDQUFFLENBQUMsR0FBRyxFQUFFLEVBQUU7UUFDeEUsR0FBRyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQWMsRUFBRSxFQUFFO1lBSS9DLE1BQU0sV0FBVyxHQUFTLElBQUksSUFBSSxDQUFFLFFBQVEsQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFFLENBQUE7WUFDcEcsTUFBTSxZQUFZLEdBQVMsSUFBSSxJQUFJLENBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBRSxDQUFBO1lBR3ZHLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxNQUFpQixDQUFDO1lBQ3BDLE1BQU0sT0FBTyxHQUFvQixNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFHM0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sS0FBSyxXQUFXLEtBQUssWUFBWSxFQUFFLENBQUMsQ0FBQTtZQUMxRCxJQUFJLENBQUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUkzQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUwsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJlc3BvbnNlVG9Kc29uLCBkYXRlVG9Vbml4U3RhbXAgfSBmcm9tICcuL3NlYXJjaC5qcydcbmltcG9ydCB7IGxvY2FsUyB9IGZyb20gJy4vbG9jYWxTdG9yYWdlLmpzJ1xuaW1wb3J0IHsgcmVuZGVyVG9hc3QgfSBmcm9tICcuL2xpYi5qcydcbmltcG9ydCB7IFRCb29rIH0gZnJvbSAnLi90eXBlcy5qcydcblxuXG5cbi8vIGNvbnN0IGZldGNoID0gcmVxdWlyZSgnbm9kZS1mZXRjaCcpXG5cblxuXG4vLyBmdW5jdGlvbiBzZWFyY2hGb3JCb29raW5nKGNoZWNrSW5EYXRlOiBEYXRlLCBjaGVja091dERhdGU6IERhdGUsIG1heFByaWNlOiBudW1iZXIpIHtcbi8vICAgbGV0IHVybCA9IGBodHRwOi8vbG9jYWxob3N0OjMwMzAvcGxhY2VzP2NoZWNrSW5EYXRlPSR7ZGF0ZVRvVW5peFN0YW1wKGNoZWNrSW5EYXRlKX0mY2hlY2tPdXREYXRlPSR7ZGF0ZVRvVW5peFN0YW1wKGNoZWNrT3V0RGF0ZSl9JmNvb3JkaW5hdGVzPTU5LjkzODYsMzAuMzE0MWBcblxuLy8gICBpZiAobWF4UHJpY2UgIT0gbnVsbCkge1xuLy8gICAgIHVybCArPSBgJm1heFByaWNlPSR7bWF4UHJpY2V9YFxuLy8gICB9XG5cbi8vICAgcmV0dXJuIHJlc3BvbnNlVG9Kc29uKGZldGNoKHVybCkpXG4vLyB9XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGJvb2socGxhY2VJZDogc3RyaW5nIHwgbnVtYmVyLCBjaGVja0luRGF0ZTogRGF0ZSB8IG51bGwsIGNoZWNrT3V0RGF0ZTogRGF0ZSB8IG51bGwpIHtcblxuICBcblxuICBpZiAocGxhY2VJZCAmJiBjaGVja0luRGF0ZSAmJiBjaGVja091dERhdGUpIHtcblxuICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZVRvSnNvbihmZXRjaChcbiAgICAgIGBodHRwOi8vbG9jYWxob3N0OjMwMzAvcGxhY2VzLyR7cGxhY2VJZH0/YCArXG4gICAgICBgY2hlY2tJbkRhdGU9JHtkYXRlVG9Vbml4U3RhbXAoY2hlY2tJbkRhdGUpfSZgICtcbiAgICAgIGBjaGVja091dERhdGU9JHtkYXRlVG9Vbml4U3RhbXAoY2hlY2tPdXREYXRlKX0mYCxcbiAgICAgIHttZXRob2Q6ICdQQVRDSCd9XG4gICAgKSk7XG5cbiAgICBpZiAoZGF0YSkge1xuXG4gICAgICBjb25zb2xlLmxvZyhgYm9va2VkOiAke3BsYWNlSWR9LCBjaGVrIGluOiAke2NoZWNrSW5EYXRlLmdldFRpbWUoKX0sIGNoZWNrIG91dDogJHtjaGVja091dERhdGUuZ2V0VGltZSgpfWApXG5cbiAgICAgIGNvbnN0IGJvb2tSZXMgPSB7XG4gICAgICAgICdpZCc6IHBsYWNlSWQsIFxuICAgICAgICAnY2hlY2tJbic6IGNoZWNrSW5EYXRlLmdldFRpbWUoKSwgXG4gICAgICAgICdjaGVja091dCc6IGNoZWNrT3V0RGF0ZS5nZXRUaW1lKClcbiAgICAgIH1cblxuICAgICAgbG9jYWxTLnNldCgnYm9va2VkJywgYm9va1JlcyApXG5cbiAgICAgIHJlbmRlclRvYXN0KFxuICAgICAgICB7IHRleHQ6IGDQktGLINC30LDQsdGA0L7QvdC40YDQvtCy0LDQu9C4INC90L7QvNC10YAgJHtwbGFjZUlkfSDRgSAke25ldyBEYXRlKGNoZWNrSW5EYXRlKS50b0xvY2FsZVN0cmluZygncnUtUlUnKX0g0L/QviAke25ldyBEYXRlKGNoZWNrT3V0RGF0ZSkudG9Mb2NhbGVTdHJpbmcoJ3J1LVJVJyl9YCwgdHlwZTogJ3N1Y2Nlc3MnIH0sXG4gICAgICAgIHsgbmFtZTogJ9Ce0LonLCBoYW5kbGVyOiAoKSA9PiB7IGNvbnNvbGUubG9nKCfQo9Cy0LXQtNC+0LzQu9C10L3QuNC1INC30LDQutGA0YvRgtC+JykgfSB9XG4gICAgICApXG5cbiAgICB9XG5cbiAgfVxuICBlbHNlIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG5cblxufVxuXG5cblxuZXhwb3J0IGZ1bmN0aW9uIGJvb2tTdGFydCgpIHtcblxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmVzdWx0LWluZm8tLWZvb3RlciBidXR0b24nKS5mb3JFYWNoKCAoZWx0KSA9PiB7XG4gICAgZWx0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2OiBNb3VzZUV2ZW50KSA9PiB7XG5cbiAgICAgIFxuXG4gICAgICBjb25zdCBjaGVja0luRGF0ZTogRGF0ZSA9IG5ldyBEYXRlIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hlY2staW4tZGF0ZScpLmdldEF0dHJpYnV0ZSgndmFsdWUnKSApXG4gICAgICBjb25zdCBjaGVja091dERhdGU6IERhdGUgPSBuZXcgRGF0ZSAoIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVjay1vdXQtZGF0ZScpLmdldEF0dHJpYnV0ZSgndmFsdWUnKSApXG5cbiAgICAgIFxuICAgICAgY29uc3QgdGFyZ2V0ID0gZXYudGFyZ2V0IGFzIEVsZW1lbnQ7XG4gICAgICBjb25zdCBwbGFjZUlkOiBzdHJpbmcgfCBudW1iZXIgPSB0YXJnZXQuY2xvc2VzdCgnLnJlc3VsdCcpLmdldEF0dHJpYnV0ZSgnaWQnKS5zdWJzdHJpbmcoNSk7XG4gICAgICBcblxuICAgICAgY29uc29sZS5sb2coYCR7cGxhY2VJZH0sICR7Y2hlY2tJbkRhdGV9LCAke2NoZWNrT3V0RGF0ZX1gKVxuICAgICAgYm9vayhwbGFjZUlkLCBjaGVja0luRGF0ZSwgY2hlY2tPdXREYXRlKTtcblxuXG4gICAgICBcbiAgICB9KTtcbiAgfSk7XG5cbn1cblxuXG5cblxuXG5cblxuXG5cblxuXG4iXX0=